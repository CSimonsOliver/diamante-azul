import{c as F,r as t,s as c,j as e,P as I,z as n,C as P}from"./index-CesZUHVg.js";import{P as A}from"./pen-DEIykQ3S.js";import{T as _}from"./trash-2-Bw3_BW04.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=F("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);function L(){const[m,C]=t.useState([]),[k,w]=t.useState(!0),[S,g]=t.useState(!1),[i,d]=t.useState(null),[s,o]=t.useState({nome:"",descricao:"",ativo:!0,ordem:0}),[x,j]=t.useState(!1),[u,f]=t.useState(null);t.useEffect(()=>{h()},[]);async function h(){const{data:a}=await c.from("categories").select("*").order("ordem");C(a||[]),w(!1)}function p(a){a?(d(a),o({nome:a.nome,descricao:a.descricao,ativo:a.ativo,ordem:a.ordem})):(d(null),o({nome:"",descricao:"",ativo:!0,ordem:m.length})),f(null),g(!0)}function b(){g(!1),d(null),o({nome:"",descricao:"",ativo:!0,ordem:0})}async function E(a){if(a.preventDefault(),!s.nome.trim()){n.error("Nome é obrigatório");return}j(!0);try{let r=(i==null?void 0:i.imagem_url)||null;if(u){const l=u.name.split(".").pop(),N=`${Date.now()}.${l}`,{error:y}=await c.storage.from("category-images").upload(N,u);if(y)throw y;const{data:D}=c.storage.from("category-images").getPublicUrl(N);r=D.publicUrl}const v={nome:s.nome.trim(),slug:P(s.nome),descricao:s.descricao.trim(),ativo:s.ativo,ordem:s.ordem,imagem_url:r};if(i){const{error:l}=await c.from("categories").update(v).eq("id",i.id);if(l)throw l;n.success("Categoria atualizada!")}else{const{error:l}=await c.from("categories").insert(v);if(l)throw l;n.success("Categoria criada!")}b(),h()}catch(r){n.error(r instanceof Error?r.message:"Erro ao salvar")}finally{j(!1)}}async function z(a){if(!confirm("Deseja excluir esta categoria?"))return;const{error:r}=await c.from("categories").delete().eq("id",a);r?n.error("Não é possível excluir: existem produtos vinculados"):(n.success("Categoria excluída!"),h())}return e.jsxs("div",{children:[e.jsxs("div",{className:"admin-page-header",children:[e.jsx("h1",{className:"admin-page-title",children:"Categorias"}),e.jsxs("button",{onClick:()=>p(),className:"btn btn-primary",children:[e.jsx(I,{size:16})," Nova Categoria"]})]}),S&&e.jsx("div",{className:"category-form-overlay",children:e.jsxs("form",{onSubmit:E,className:"category-form card",children:[e.jsx("h2",{children:i?"Editar Categoria":"Nova Categoria"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome *"}),e.jsx("input",{value:s.nome,onChange:a=>o({...s,nome:a.target.value}),placeholder:"Ex: Torneiras"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Descrição"}),e.jsx("textarea",{value:s.descricao,onChange:a=>o({...s,descricao:a.target.value}),rows:3,placeholder:"Descrição da categoria"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Ordem"}),e.jsx("input",{type:"number",value:s.ordem,onChange:a=>o({...s,ordem:Number(a.target.value)})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Imagem"}),e.jsx("input",{type:"file",accept:"image/*",onChange:a=>{var r;return f(((r=a.target.files)==null?void 0:r[0])||null)}})]})]}),e.jsxs("div",{className:"form-group",style:{flexDirection:"row",alignItems:"center",gap:8},children:[e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:s.ativo,onChange:a=>o({...s,ativo:a.target.checked})}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("span",{className:"form-label",children:"Ativa"})]}),e.jsxs("div",{className:"category-form-actions",children:[e.jsx("button",{type:"button",onClick:b,className:"btn btn-outline",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:x,children:x?"Salvando...":i?"Atualizar":"Criar"})]})]})}),k?e.jsx("div",{className:"skeleton",style:{height:200}}):m.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(T,{size:48}),e.jsx("h3",{children:"Nenhuma categoria"}),e.jsx("p",{children:"Crie sua primeira categoria para organizar os produtos."})]}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ordem"}),e.jsx("th",{children:"Imagem"}),e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:m.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.ordem}),e.jsx("td",{children:a.imagem_url?e.jsx("img",{src:a.imagem_url,alt:"",className:"cat-thumb"}):e.jsx("div",{className:"cat-thumb-placeholder"})}),e.jsx("td",{children:e.jsx("strong",{children:a.nome})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${a.ativo?"badge-green":"badge-gray"}`,children:a.ativo?"Ativa":"Inativa"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(a),className:"btn btn-sm btn-outline",title:"Editar",children:e.jsx(A,{size:14})}),e.jsx("button",{onClick:()=>z(a.id),className:"btn btn-sm btn-danger",title:"Excluir",children:e.jsx(_,{size:14})})]})})]},a.id))})]})})]})}export{L as default};
