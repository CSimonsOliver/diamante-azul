import{c as O,e as V,u as H,r as f,j as e,H as J,o as Y,n as K,p as X,q as Q,k as C,l as z,h as l,f as Z,A as ee,m as A,z as t,s as re,t as se,v as ae}from"./index-CesZUHVg.js";import{B as oe}from"./Breadcrumb-fwi0s3ck.js";import{T as te}from"./truck-BsSurM5U.js";import{A as ne}from"./arrow-left-cWm2AP-2.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=O("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=O("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),le=[{icon:ce,label:"Dados"},{icon:Y,label:"EndereÃ§o"},{icon:te,label:"Frete"},{icon:K,label:"Resumo"}];function he(){var _;const{items:u,getSubtotal:D,clearCart:T}=V(),{settings:p}=H(),[i,y]=f.useState(0),[s,g]=f.useState({customer:{nome:"",email:"",cpf:"",telefone:""},address:{cep:"",logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",estado:"",referencia:""},shipping:null}),[E,S]=f.useState([]),[L,k]=f.useState(!1),[P,$]=f.useState(!1),h=D(),F=(p==null?void 0:p.frete_gratis_acima)||299,m=h>=F,x=m?0:((_=s.shipping)==null?void 0:_.preco)||0,v=h+x;function j(r,a){g(o=>({...o,customer:{...o.customer,[r]:a}}))}function d(r,a){g(o=>({...o,address:{...o.address,[r]:a}}))}async function R(){const r=C(s.address.cep);if(!A(r)){t.error("CEP invÃ¡lido");return}try{const o=await(await fetch(`https://viacep.com.br/ws/${r}/json/`)).json();if(o.erro){t.error("CEP nÃ£o encontrado");return}g(n=>({...n,address:{...n.address,logradouro:o.logradouro||n.address.logradouro,bairro:o.bairro||n.address.bairro,cidade:o.localidade||n.address.cidade,estado:o.uf||n.address.estado}})),t.success("EndereÃ§o encontrado!")}catch{t.error("Erro ao buscar CEP")}}async function B(){k(!0);try{const r=await fetch("https://YOUR_PROJECT.supabase.co/functions/v1/calculate-shipping",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer YOUR_ANON_KEY"},body:JSON.stringify({cep_destino:C(s.address.cep),produtos:u.map(a=>({peso:a.product.peso_kg,altura:a.product.altura_cm,largura:a.product.largura_cm,comprimento:a.product.comprimento_cm,quantidade:a.quantity}))})});if(!r.ok)throw new Error;S(await r.json())}catch{S([{id:"1",nome:"PAC",empresa:"Correios",preco:18.5,prazo_dias:7,logo:""},{id:"2",nome:"SEDEX",empresa:"Correios",preco:32.9,prazo_dias:3,logo:""}])}finally{k(!1)}}function q(){if(i===0){if(!s.customer.nome.trim())return t.error("Preencha o nome"),!1;if(!se(s.customer.email))return t.error("Email invÃ¡lido"),!1;if(!ae(s.customer.cpf))return t.error("CPF invÃ¡lido"),!1;if(!s.customer.telefone.replace(/\D/g,"").length)return t.error("Preencha o telefone"),!1}if(i===1){if(!A(s.address.cep))return t.error("CEP invÃ¡lido"),!1;if(!s.address.logradouro.trim())return t.error("Preencha o logradouro"),!1;if(!s.address.numero.trim())return t.error("Preencha o nÃºmero"),!1;if(!s.address.bairro.trim())return t.error("Preencha o bairro"),!1;if(!s.address.cidade.trim())return t.error("Preencha a cidade"),!1}return i===2&&!m&&!s.shipping?(t.error("Selecione uma opÃ§Ã£o de frete"),!1):!0}function W(){q()&&(i===1&&E.length===0&&B(),y(r=>Math.min(3,r+1)))}async function U(){var r,a,o;$(!0);try{const{error:n}=await re.from("orders").insert({customer_name:s.customer.nome,customer_email:s.customer.email,customer_cpf:s.customer.cpf,customer_phone:s.customer.telefone,shipping_address:s.address,items:u.map(c=>{var b,w;return{product_id:c.product.id,nome:c.product.nome,sku:c.product.sku,preco:c.product.preco_promocional??c.product.preco,quantidade:c.quantity,imagem_url:((w=(b=c.product.imagens)==null?void 0:b[0])==null?void 0:w.url)||null}}),subtotal:h,shipping_cost:x,shipping_method:m?"Frete GrÃ¡tis":((r=s.shipping)==null?void 0:r.nome)||"",total:v,status:"aguardando_confirmacao",whatsapp_sent_at:new Date().toISOString()});n&&console.error("Order save error:",n);const N=u.map(c=>{const b=c.product.preco_promocional??c.product.preco;return`â€¢ ${c.quantity}x ${c.product.nome} - ${l(b)} (cada)`}).join(`
`),G=m?"GrÃ¡tis ğŸ‰":`${(a=s.shipping)==null?void 0:a.nome} - ${(o=s.shipping)==null?void 0:o.prazo_dias} dias Ãºteis`,I=`OlÃ¡! Gostaria de fazer um pedido: ğŸ›’

*DADOS DO PEDIDO*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
*Produtos:*
${N}

*Subtotal:* ${l(h)}
*Frete (${G}):* ${m?"R$ 0,00":l(x)}
*TOTAL: ${l(v)}*

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
*DADOS DO CLIENTE*
Nome: ${s.customer.nome}
Email: ${s.customer.email}
CPF: ${s.customer.cpf}
Telefone: ${s.customer.telefone}

*ENDEREÃ‡O DE ENTREGA*
${s.address.logradouro}, ${s.address.numero}${s.address.complemento?` - ${s.address.complemento}`:""}
${s.address.bairro} - ${s.address.cidade}/${s.address.estado}
CEP: ${z(s.address.cep)}
${s.address.referencia?`ReferÃªncia: ${s.address.referencia}`:""}

Aguardo confirmaÃ§Ã£o e forma de pagamento! ğŸ˜Š`,M=`https://wa.me/${(p==null?void 0:p.whatsapp)||"5562999999999"}?text=${encodeURIComponent(I)}`;window.open(M,"_blank"),T(),t.success("Pedido enviado! Confira o WhatsApp.")}catch{t.error("Erro ao processar pedido")}finally{$(!1)}}return u.length===0&&i<3?e.jsxs("div",{className:"container",style:{padding:"64px 24px",textAlign:"center"},children:[e.jsx(ie,{size:64,color:"var(--color-success)",style:{margin:"0 auto 16px"}}),e.jsx("h2",{children:"Pedido Enviado!"}),e.jsx("p",{style:{color:"var(--color-text-muted)",marginTop:8},children:"Confira o WhatsApp para dar continuidade."}),e.jsx("a",{href:"/",className:"btn btn-primary mt-6",children:"Voltar Ã  Loja"})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsx("title",{children:"Checkout â€” Diamante Azul"})}),e.jsx(oe,{items:[{label:"Carrinho",href:"/carrinho"},{label:"Checkout"}]}),e.jsxs("div",{className:"container checkout-page",children:[e.jsx("div",{className:"checkout-steps",children:le.map((r,a)=>e.jsxs("div",{className:`checkout-step ${a===i?"active":""} ${a<i?"done":""}`,children:[e.jsx("div",{className:"checkout-step-icon",children:e.jsx(r.icon,{size:18})}),e.jsx("span",{children:r.label})]},a))}),e.jsxs("div",{className:"checkout-content",children:[i===0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{style:{fontSize:18,fontWeight:600,marginBottom:20},children:"Dados do Cliente"}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"form-label",children:"Nome Completo *"}),e.jsx("input",{value:s.customer.nome,onChange:r=>j("nome",r.target.value),placeholder:"JoÃ£o Silva"})]}),e.jsxs("div",{className:"form-row mb-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Email *"}),e.jsx("input",{type:"email",value:s.customer.email,onChange:r=>j("email",r.target.value),placeholder:"joao@email.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CPF *"}),e.jsx("input",{value:X(s.customer.cpf),onChange:r=>j("cpf",r.target.value.replace(/\D/g,"")),placeholder:"000.000.000-00",maxLength:14})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Telefone *"}),e.jsx("input",{value:Q(s.customer.telefone),onChange:r=>j("telefone",r.target.value.replace(/\D/g,"")),placeholder:"(62) 99999-9999",maxLength:15})]})]}),i===1&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{style:{fontSize:18,fontWeight:600,marginBottom:20},children:"EndereÃ§o de Entrega"}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"form-label",children:"CEP *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:z(s.address.cep),onChange:r=>d("cep",C(r.target.value)),placeholder:"00000-000",maxLength:9,style:{flex:1}}),e.jsx("button",{type:"button",onClick:R,className:"btn btn-outline",children:"Buscar"})]})]}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"form-label",children:"Logradouro *"}),e.jsx("input",{value:s.address.logradouro,onChange:r=>d("logradouro",r.target.value)})]}),e.jsxs("div",{className:"form-row mb-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"NÃºmero *"}),e.jsx("input",{value:s.address.numero,onChange:r=>d("numero",r.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Complemento"}),e.jsx("input",{value:s.address.complemento,onChange:r=>d("complemento",r.target.value),placeholder:"Apto, bloco..."})]})]}),e.jsxs("div",{className:"form-row mb-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Bairro *"}),e.jsx("input",{value:s.address.bairro,onChange:r=>d("bairro",r.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Cidade *"}),e.jsx("input",{value:s.address.cidade,onChange:r=>d("cidade",r.target.value)})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Estado *"}),e.jsx("input",{value:s.address.estado,onChange:r=>d("estado",r.target.value),maxLength:2})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"ReferÃªncia"}),e.jsx("input",{value:s.address.referencia,onChange:r=>d("referencia",r.target.value),placeholder:"PrÃ³ximo ao..."})]})]})]}),i===2&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{style:{fontSize:18,fontWeight:600,marginBottom:20},children:"OpÃ§Ãµes de Frete"}),m?e.jsx("div",{className:"badge badge-green",style:{width:"100%",justifyContent:"center",padding:16,fontSize:16},children:"ğŸ‰ Frete GrÃ¡tis!"}):L?e.jsx("div",{className:"skeleton",style:{height:120}}):e.jsx("div",{className:"checkout-shipping-options",children:E.map(r=>{var a,o;return e.jsxs("label",{className:`checkout-shipping-opt ${((a=s.shipping)==null?void 0:a.id)===r.id?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"shipping",checked:((o=s.shipping)==null?void 0:o.id)===r.id,onChange:()=>g(n=>({...n,shipping:r}))}),e.jsxs("div",{children:[e.jsxs("strong",{children:[r.nome," (",r.empresa,")"]}),e.jsxs("span",{children:[r.prazo_dias," dias Ãºteis"]})]}),e.jsx("strong",{style:{color:"var(--color-primary)"},children:l(r.preco)})]},r.id)})})]}),i===3&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{style:{fontSize:18,fontWeight:600,marginBottom:20},children:"Resumo do Pedido"}),e.jsx("div",{className:"checkout-summary-items",children:u.map(r=>{var o,n;const a=r.product.preco_promocional??r.product.preco;return e.jsxs("div",{className:"checkout-summary-item",children:[e.jsx("img",{src:Z((n=(o=r.product.imagens)==null?void 0:o[0])==null?void 0:n.url),alt:"",className:"checkout-summary-img",onError:N=>{N.target.src="/placeholder-product.svg"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("p",{style:{fontSize:14,fontWeight:500},children:r.product.nome}),e.jsxs("p",{style:{fontSize:13,color:"var(--color-text-muted)"},children:[r.quantity,"x ",l(a)]})]}),e.jsx("strong",{children:l(a*r.quantity)})]},r.product.id)})}),e.jsxs("div",{style:{borderTop:"1px solid var(--color-border)",marginTop:16,paddingTop:16},children:[e.jsxs("div",{className:"cart-summary-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:l(h)})]}),e.jsxs("div",{className:"cart-summary-row",children:[e.jsx("span",{children:"Frete"}),e.jsx("span",{children:m?"GrÃ¡tis":l(x)})]}),e.jsxs("div",{className:"cart-summary-total",children:[e.jsx("span",{children:"Total"}),e.jsx("strong",{children:l(v)})]})]})]}),e.jsxs("div",{className:"checkout-nav",children:[i>0&&e.jsxs("button",{onClick:()=>y(r=>r-1),className:"btn btn-outline",children:[e.jsx(ne,{size:16})," Voltar"]}),e.jsx("div",{style:{flex:1}}),i<3?e.jsxs("button",{onClick:W,className:"btn btn-primary btn-lg",children:["Continuar ",e.jsx(ee,{size:16})]}):e.jsx("button",{onClick:U,className:"btn btn-success btn-lg",disabled:P,children:P?"Enviando...":"âœ… Finalizar pelo WhatsApp"})]})]})]})]})}export{he as default};
