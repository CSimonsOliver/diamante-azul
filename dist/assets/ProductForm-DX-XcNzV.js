import{b as T,y as O,r as i,s as d,j as e,X as S,P as B,z as n,C as M}from"./index-CesZUHVg.js";import{A as V}from"./arrow-left-cWm2AP-2.js";import{U as K}from"./upload-CMDWCLbI.js";import{T as X}from"./trash-2-Bw3_BW04.js";const Z={nome:"",descricao_curta:"",descricao_completa:"",preco:"",preco_promocional:"",sku:"",estoque:"0",category_id:"",peso_kg:"0",altura_cm:"0",largura_cm:"0",comprimento_cm:"0",ativo:!0,destaque:!1,tags:"",especificacoes:[]};function W(){const{id:u}=T(),p=u&&u!=="novo",x=O(),[r,g]=i.useState(Z),[P,q]=i.useState([]),[h,b]=i.useState([]),[f,v]=i.useState([]),[N,_]=i.useState(!1),[w,A]=i.useState(!!p);i.useEffect(()=>{E(),p&&z()},[u]);async function E(){const{data:a}=await d.from("categories").select("*").order("nome");q(a||[])}async function z(){const{data:a}=await d.from("products").select("*").eq("id",u).single();if(a){const s=a,c=s.especificacoes||{};g({nome:s.nome,descricao_curta:s.descricao_curta,descricao_completa:s.descricao_completa,preco:String(s.preco),preco_promocional:s.preco_promocional?String(s.preco_promocional):"",sku:s.sku,estoque:String(s.estoque),category_id:s.category_id,peso_kg:String(s.peso_kg),altura_cm:String(s.altura_cm),largura_cm:String(s.largura_cm),comprimento_cm:String(s.comprimento_cm),ativo:s.ativo,destaque:s.destaque,tags:(s.tags||[]).join(", "),especificacoes:Object.entries(c).map(([l,m])=>({chave:l,valor:m}))}),b(s.imagens||[])}A(!1)}function t(a,s){g(c=>({...c,[a]:s}))}function D(){g(a=>({...a,especificacoes:[...a.especificacoes,{chave:"",valor:""}]}))}function y(a,s,c){const l=[...r.especificacoes];l[a][s]=c,g(m=>({...m,especificacoes:l}))}function F(a){g(s=>({...s,especificacoes:s.especificacoes.filter((c,l)=>l!==a)}))}function I(a){const s=Array.from(a.target.files||[]);if(h.length+f.length+s.length>8){n.error("Máximo de 8 imagens");return}v(l=>[...l,...s])}function U(a){b(s=>s.filter((c,l)=>l!==a))}function L(a){v(s=>s.filter((c,l)=>l!==a))}async function R(a){if(a.preventDefault(),!r.nome.trim()){n.error("Nome é obrigatório");return}if(!r.category_id){n.error("Selecione uma categoria");return}if(!r.preco||Number(r.preco)<=0){n.error("Preço inválido");return}_(!0);try{const s=[];for(const o of f){const j=o.name.split(".").pop(),C=`${Date.now()}-${Math.random().toString(36).substring(7)}.${j}`,{error:k}=await d.storage.from("product-images").upload(C,o);if(k)throw k;const{data:$}=d.storage.from("product-images").getPublicUrl(C);s.push({url:$.publicUrl,ordem:h.length+s.length})}const c=[...h,...s].map((o,j)=>({...o,ordem:j})),l={};r.especificacoes.forEach(o=>{o.chave.trim()&&(l[o.chave.trim()]=o.valor.trim())});const m={nome:r.nome.trim(),slug:M(r.nome),descricao_curta:r.descricao_curta.trim(),descricao_completa:r.descricao_completa.trim(),preco:Number(r.preco),preco_promocional:r.preco_promocional?Number(r.preco_promocional):null,sku:r.sku.trim(),estoque:Number(r.estoque),category_id:r.category_id,peso_kg:Number(r.peso_kg),altura_cm:Number(r.altura_cm),largura_cm:Number(r.largura_cm),comprimento_cm:Number(r.comprimento_cm),ativo:r.ativo,destaque:r.destaque,imagens:c,especificacoes:l,tags:r.tags.split(",").map(o=>o.trim()).filter(Boolean)};if(p){const{error:o}=await d.from("products").update(m).eq("id",u);if(o)throw o;n.success("Produto atualizado!")}else{const{error:o}=await d.from("products").insert(m);if(o)throw o;n.success("Produto criado!")}x("/admin/produtos")}catch(s){n.error(s instanceof Error?s.message:"Erro ao salvar")}finally{_(!1)}}return w?e.jsx("div",{className:"skeleton",style:{height:400}}):e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>x("/admin/produtos"),className:"btn btn-outline btn-sm mb-4",children:[e.jsx(V,{size:16})," Voltar"]}),e.jsx("h1",{className:"admin-page-title",children:p?"Editar Produto":"Novo Produto"}),e.jsxs("form",{onSubmit:R,className:"product-form",children:[e.jsxs("div",{className:"product-form-main",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"form-section-title",children:"Informações Básicas"}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"form-label",children:"Nome do Produto *"}),e.jsx("input",{value:r.nome,onChange:a=>t("nome",a.target.value),placeholder:"Ex: Torneira Bica Alta Lavabo"})]}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"form-label",children:"Descrição Curta"}),e.jsx("input",{value:r.descricao_curta,onChange:a=>t("descricao_curta",a.target.value),placeholder:"Resumo do produto"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Descrição Completa"}),e.jsx("textarea",{value:r.descricao_completa,onChange:a=>t("descricao_completa",a.target.value),rows:5,placeholder:"Detalhes completos do produto"})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"form-section-title",children:"Imagens"}),e.jsxs("div",{className:"product-images-grid",children:[h.map((a,s)=>e.jsxs("div",{className:"product-image-item",children:[e.jsx("img",{src:a.url,alt:""}),e.jsx("button",{type:"button",onClick:()=>U(s),className:"product-image-remove",children:e.jsx(S,{size:14})}),s===0&&e.jsx("span",{className:"product-image-main",children:"Principal"})]},s)),f.map((a,s)=>e.jsxs("div",{className:"product-image-item",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:""}),e.jsx("button",{type:"button",onClick:()=>L(s),className:"product-image-remove",children:e.jsx(S,{size:14})})]},`new-${s}`)),h.length+f.length<8&&e.jsxs("label",{className:"product-image-upload",children:[e.jsx(K,{size:24}),e.jsx("span",{children:"Adicionar"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:I,hidden:!0})]})]}),e.jsx("p",{className:"form-hint mt-2",children:"Até 8 imagens. A primeira será a imagem principal."})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"form-section-title",children:"Especificações Técnicas"}),r.especificacoes.map((a,s)=>e.jsxs("div",{className:"spec-row",children:[e.jsx("input",{value:a.chave,onChange:c=>y(s,"chave",c.target.value),placeholder:"Chave (ex: Material)"}),e.jsx("input",{value:a.valor,onChange:c=>y(s,"valor",c.target.value),placeholder:"Valor (ex: Aço Inox)"}),e.jsx("button",{type:"button",onClick:()=>F(s),className:"btn btn-sm btn-outline",style:{flexShrink:0},children:e.jsx(X,{size:14})})]},s)),e.jsxs("button",{type:"button",onClick:D,className:"btn btn-sm btn-outline mt-2",children:[e.jsx(B,{size:14})," Adicionar Especificação"]})]})]}),e.jsxs("div",{className:"product-form-sidebar",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"form-section-title",children:"Publicação"}),e.jsxs("div",{className:"form-group mb-4",style:{flexDirection:"row",alignItems:"center",gap:8},children:[e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:r.ativo,onChange:a=>t("ativo",a.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("span",{className:"form-label",children:"Produto Ativo"})]}),e.jsxs("div",{className:"form-group",style:{flexDirection:"row",alignItems:"center",gap:8},children:[e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:r.destaque,onChange:a=>t("destaque",a.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("span",{className:"form-label",children:"Produto Destaque"})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"form-section-title",children:"Organização"}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"form-label",children:"Categoria *"}),e.jsxs("select",{value:r.category_id,onChange:a=>t("category_id",a.target.value),children:[e.jsx("option",{value:"",children:"Selecione..."}),P.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"form-label",children:"SKU"}),e.jsx("input",{value:r.sku,onChange:a=>t("sku",a.target.value),placeholder:"DAZ-001"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Tags"}),e.jsx("input",{value:r.tags,onChange:a=>t("tags",a.target.value),placeholder:"tag1, tag2, tag3"}),e.jsx("span",{className:"form-hint",children:"Separadas por vírgula"})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"form-section-title",children:"Preço & Estoque"}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"form-label",children:"Preço (R$) *"}),e.jsx("input",{type:"number",step:"0.01",value:r.preco,onChange:a=>t("preco",a.target.value)})]}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"form-label",children:"Preço Promocional (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:r.preco_promocional,onChange:a=>t("preco_promocional",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Estoque"}),e.jsx("input",{type:"number",value:r.estoque,onChange:a=>t("estoque",a.target.value)})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"form-section-title",children:"Dimensões (Frete)"}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"form-label",children:"Peso (kg)"}),e.jsx("input",{type:"number",step:"0.001",value:r.peso_kg,onChange:a=>t("peso_kg",a.target.value)})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Altura (cm)"}),e.jsx("input",{type:"number",step:"0.1",value:r.altura_cm,onChange:a=>t("altura_cm",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Largura (cm)"}),e.jsx("input",{type:"number",step:"0.1",value:r.largura_cm,onChange:a=>t("largura_cm",a.target.value)})]})]}),e.jsxs("div",{className:"form-group mt-3",children:[e.jsx("label",{className:"form-label",children:"Comprimento (cm)"}),e.jsx("input",{type:"number",step:"0.1",value:r.comprimento_cm,onChange:a=>t("comprimento_cm",a.target.value)})]})]})]}),e.jsxs("div",{className:"product-form-footer",children:[e.jsx("button",{type:"button",onClick:()=>x("/admin/produtos"),className:"btn btn-outline",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-lg",disabled:N,children:N?"Salvando...":p?"Atualizar Produto":"Criar Produto"})]})]})]})}export{W as default};
