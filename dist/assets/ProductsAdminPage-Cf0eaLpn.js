import{r as a,B as k,s as l,j as e,P as z,S as w,C as E,h as u,L,z as m}from"./index-BnOxMvvE.js";import{T as A}from"./triangle-alert-BPaxCLTd.js";import{P as T}from"./pen-DILza9kS.js";import{T as _}from"./trash-2-DxBiVAkh.js";function R(){const[j,g]=a.useState([]),[v,f]=a.useState([]),[p,b]=a.useState(!0),[i,N]=a.useState(""),[c,y]=a.useState(""),[r,C]=a.useState(""),S=k();a.useEffect(()=>{d()},[]);async function d(){const[s,t]=await Promise.all([l.from("products").select("*, categories(nome)").order("created_at",{ascending:!1}),l.from("categories").select("*").order("nome")]),n=(s.data||[]).map(o=>({...o,category:o.categories}));g(n),f(t.data||[]),b(!1)}const h=j.filter(s=>!(i&&!s.nome.toLowerCase().includes(i.toLowerCase())&&!s.sku.toLowerCase().includes(i.toLowerCase())||c&&s.category_id!==c||r==="ativo"&&!s.ativo||r==="inativo"&&s.ativo||r==="destaque"&&!s.destaque||r==="estoque_baixo"&&s.estoque>=5));async function q(s){if(!confirm("Deseja excluir este produto?"))return;const{error:t}=await l.from("products").delete().eq("id",s);if(t){m.error("Erro ao excluir");return}m.success("Produto excluído!"),d()}async function P(s,t){await l.from("products").update({ativo:!t}).eq("id",s),d()}return e.jsxs("div",{children:[e.jsxs("div",{className:"admin-page-header",children:[e.jsx("h1",{className:"admin-page-title",children:"Produtos"}),e.jsxs("button",{onClick:()=>S("/admin/produtos/novo"),className:"btn btn-primary",children:[e.jsx(z,{size:16})," Novo Produto"]})]}),e.jsx("div",{className:"products-filters card p-4 mb-4",children:e.jsxs("div",{className:"products-filters-row",children:[e.jsxs("div",{className:"products-search",children:[e.jsx(w,{size:16,className:"products-search-icon"}),e.jsx("input",{type:"text",placeholder:"Buscar por nome ou SKU...",value:i,onChange:s=>N(s.target.value)})]}),e.jsxs("select",{value:c,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"Todas categorias"}),v.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]}),e.jsxs("select",{value:r,onChange:s=>C(s.target.value),children:[e.jsx("option",{value:"",children:"Todos status"}),e.jsx("option",{value:"ativo",children:"Ativo"}),e.jsx("option",{value:"inativo",children:"Inativo"}),e.jsx("option",{value:"destaque",children:"Destaque"}),e.jsx("option",{value:"estoque_baixo",children:"Estoque Baixo"})]})]})}),p?e.jsx("div",{className:"skeleton",style:{height:300}}):h.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(E,{size:48}),e.jsx("h3",{children:"Nenhum produto encontrado"}),e.jsx("p",{children:"Crie seu primeiro produto ou ajuste os filtros."})]}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Imagem"}),e.jsx("th",{children:"Produto"}),e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Preço"}),e.jsx("th",{children:"Estoque"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:h.map(s=>{var n,o,x;const t=(o=(n=s.imagens)==null?void 0:n[0])==null?void 0:o.url;return e.jsxs("tr",{children:[e.jsx("td",{children:t?e.jsx("img",{src:t,alt:"",className:"prod-thumb"}):e.jsx("div",{className:"prod-thumb-placeholder"})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("strong",{className:"truncate",style:{maxWidth:200,display:"block"},children:s.nome}),e.jsx("span",{style:{fontSize:12,color:"var(--color-text-muted)"},children:(x=s.category)==null?void 0:x.nome})]})}),e.jsx("td",{children:s.sku||"—"}),e.jsx("td",{children:s.preco_promocional?e.jsxs("div",{children:[e.jsx("span",{className:"price-old",style:{fontSize:12},children:u(s.preco)}),e.jsx("br",{}),e.jsx("strong",{children:u(s.preco_promocional)})]}):e.jsx("strong",{children:u(s.preco)})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.estoque<5?s.estoque===0?"badge-red":"badge-yellow":"badge-green"}`,children:s.estoque===0?e.jsxs(e.Fragment,{children:[e.jsx(A,{size:12})," Esgotado"]}):s.estoque})}),e.jsx("td",{children:e.jsxs("label",{className:"toggle",title:s.ativo?"Ativo":"Inativo",children:[e.jsx("input",{type:"checkbox",checked:s.ativo,onChange:()=>P(s.id,s.ativo)}),e.jsx("span",{className:"toggle-slider"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{to:`/admin/produtos/${s.id}`,className:"btn btn-sm btn-outline",title:"Editar",children:e.jsx(T,{size:14})}),e.jsx("button",{onClick:()=>q(s.id),className:"btn btn-sm btn-danger",title:"Excluir",children:e.jsx(_,{size:14})})]})})]},s.id)})})]})})]})}export{R as default};
