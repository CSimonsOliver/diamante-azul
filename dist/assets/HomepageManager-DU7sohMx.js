import{c as Y,r as u,s as c,j as e,L as Z,P as T,F as L,z as l}from"./index-Cyx07lUy.js";import{A as ee}from"./arrow-left-DyturPF8.js";import{T as F}from"./trash-2-QKwBV2jt.js";import{E as se}from"./eye-C3qHwsAR.js";import{E as ae}from"./eye-off-QyAcxC8U.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=Y("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);function ce(){const[x,M]=u.useState([]),[g,N]=u.useState([]),[p,I]=u.useState({}),[O,R]=u.useState([]),[$,C]=u.useState(!0),[y,w]=u.useState(!1),[j,k]=u.useState("banners"),[i,m]=u.useState(null),[H,v]=u.useState(!1),[S,U]=u.useState(""),[G,f]=u.useState(!1);u.useEffect(()=>{h()},[]);async function h(){C(!0);const{data:s}=await c.from("homepage_banners").select("*").order("sort_order"),{data:a}=await c.from("homepage_config").select("*").order("sort_order"),{data:t}=await c.from("products").select("id, nome, sku, preco, preco_promocional, imagens, ativo").eq("ativo",!0).order("nome");if(s&&M(s),a){N(a);const r={};for(const o of a)if(o.section_name!=="banners"&&o.section_name!=="benefits"&&o.section_name!=="categories"){const{data:d}=await c.from("homepage_products").select(`
              id,
              section_id,
              product_id,
              sort_order,
              is_active,
              product:products(id, nome, sku, preco, preco_promocional, imagens, ativo)
            `).eq("section_id",o.id).order("sort_order");d&&(r[o.id]=d.map(n=>({...n,product:n.product})))}I(r)}t&&R(t),C(!1)}async function V(s){if(w(!0),s.id){const{error:a}=await c.from("homepage_banners").update(s).eq("id",s.id);a?(l.error("Erro ao atualizar banner"),console.error(a)):(l.success("Banner atualizado!"),h(),v(!1),m(null))}else{const{error:a}=await c.from("homepage_banners").insert([{...s,title:s.title||"",sort_order:x.length+1}]);a?(l.error("Erro ao criar banner"),console.error(a)):(l.success("Banner criado!"),h(),v(!1),m(null))}w(!1)}async function J(s){if(!confirm("Tem certeza que deseja excluir este banner?"))return;const{error:a}=await c.from("homepage_banners").delete().eq("id",s);a?l.error("Erro ao excluir banner"):(l.success("Banner excluído!"),h())}async function B(s,a){const t=x.findIndex(n=>n.id===s);if(t===-1)return;const r=a==="up"?t-1:t+1;if(r<0||r>=x.length)return;const o=[...x],d=o[t].sort_order;o[t].sort_order=o[r].sort_order,o[r].sort_order=d,await c.from("homepage_banners").update({sort_order:o[t].sort_order}).eq("id",o[t].id),await c.from("homepage_banners").update({sort_order:o[r].sort_order}).eq("id",o[r].id),h()}async function K(s,a){const{error:t}=await c.from("homepage_config").update({is_active:!a}).eq("id",s);t?l.error("Erro ao atualizar seção"):(l.success(a?"Seção desativada":"Seção ativada"),h())}async function P(s,a,t){const{error:r}=await c.from("homepage_config").update({title:a,subtitle:t}).eq("id",s);r?l.error("Erro ao atualizar título"):(l.success("Título atualizado!"),h())}async function Q(s,a){const t=p[s]||[],{error:r}=await c.from("homepage_products").insert([{section_id:s,product_id:a,sort_order:t.length+1,is_active:!0}]);r?(l.error("Erro ao adicionar produto"),console.error(r)):(l.success("Produto adicionado!"),h())}async function W(s){const{error:a}=await c.from("homepage_products").delete().eq("id",s);a?l.error("Erro ao remover produto"):(l.success("Produto removido!"),h())}async function z(s,a,t){const r=p[s]||[],o=r.findIndex(b=>b.id===a);if(o===-1)return;const d=t==="up"?o-1:o+1;if(d<0||d>=r.length)return;const n=[...r],_=n[o].sort_order;n[o].sort_order=n[d].sort_order,n[d].sort_order=_,await c.from("homepage_products").update({sort_order:n[o].sort_order}).eq("id",n[o].id),await c.from("homepage_products").update({sort_order:n[d].sort_order}).eq("id",n[d].id),h()}const X=g.filter(s=>s.section_name!=="banners"&&s.section_name!=="benefits"&&s.section_name!=="categories");return e.jsxs("div",{className:"homepage-manager",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Z,{to:"/admin",className:"btn-back",children:e.jsx(ee,{size:20})}),e.jsx("h1",{children:"Gerenciar HomePage"})]})}),e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:j==="banners"?"active":"",onClick:()=>k("banners"),children:"Banners"}),e.jsx("button",{className:j==="sections"?"active":"",onClick:()=>k("sections"),children:"Seções"}),e.jsx("button",{className:j==="products"?"active":"",onClick:()=>k("products"),children:"Produtos por Seção"})]}),$?e.jsx("div",{className:"loading",children:"Carregando..."}):e.jsxs(e.Fragment,{children:[j==="banners"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"Banners do Carrossel"}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{m({id:"",tag:"",title:"",description:"",image_url:"",link_url:"/produtos",button_text:"Ver Mais",is_active:!0,sort_order:0}),v(!0)},children:[e.jsx(T,{size:18})," Novo Banner"]})]}),e.jsx("div",{className:"banners-list",children:x.map((s,a)=>e.jsxs("div",{className:`banner-card ${s.is_active?"":"inactive"}`,children:[e.jsxs("div",{className:"banner-image",children:[e.jsx("img",{src:s.image_url||"/placeholder-product.svg",alt:s.title}),!s.is_active&&e.jsx("span",{className:"badge-inactive",children:"Inativo"})]}),e.jsxs("div",{className:"banner-info",children:[e.jsx("span",{className:"banner-tag",children:s.tag}),e.jsx("h3",{children:s.title}),e.jsx("p",{children:s.description}),e.jsxs("div",{className:"banner-meta",children:[e.jsxs("span",{children:["Link: ",s.link_url]}),e.jsxs("span",{children:["Botão: ",s.button_text]})]})]}),e.jsxs("div",{className:"banner-actions",children:[e.jsx("button",{onClick:()=>B(s.id,"up"),disabled:a===0,children:e.jsx(L,{size:18})}),e.jsx("button",{onClick:()=>B(s.id,"down"),disabled:a===x.length-1,children:e.jsx(D,{size:18})}),e.jsx("button",{onClick:()=>{m(s),v(!0)},children:"Editar"}),e.jsx("button",{className:"btn-danger",onClick:()=>J(s.id),children:e.jsx(F,{size:18})})]})]},s.id))})]}),j==="sections"&&e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"section-header",children:e.jsx("h2",{children:"Configurar Seções"})}),e.jsx("div",{className:"sections-list",children:g.map(s=>e.jsxs("div",{className:`section-config-card ${s.is_active?"":"inactive"}`,children:[e.jsxs("div",{className:"section-config-header",children:[e.jsx("h3",{children:s.title}),e.jsx("button",{className:`btn-toggle ${s.is_active?"active":""}`,onClick:()=>K(s.id,s.is_active),children:s.is_active?e.jsx(se,{size:18}):e.jsx(ae,{size:18})})]}),e.jsxs("div",{className:"section-config-fields",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Título da Seção"}),e.jsx("input",{type:"text",value:s.title||"",onChange:a=>{const t=g.map(r=>r.id===s.id?{...r,title:a.target.value}:r);N(t)},onBlur:a=>P(s.id,a.target.value,s.subtitle||"")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Subtítulo"}),e.jsx("input",{type:"text",value:s.subtitle||"",onChange:a=>{const t=g.map(r=>r.id===s.id?{...r,subtitle:a.target.value}:r);N(t)},onBlur:a=>P(s.id,s.title||"",a.target.value)})]})]})]},s.id))})]}),j==="products"&&e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"section-header",children:e.jsx("h2",{children:"Produtos por Seção"})}),e.jsx("div",{className:"products-sections",children:X.map(s=>e.jsxs("div",{className:"product-section-card",children:[e.jsxs("div",{className:"product-section-header",children:[e.jsx("h3",{children:s.title}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{U(s.id),f(!0)},children:[e.jsx(T,{size:18})," Adicionar Produto"]})]}),e.jsx("div",{className:"section-products-list",children:(p[s.id]||[]).length===0?e.jsx("p",{className:"no-products",children:"Nenhum produto adicionado"}):(p[s.id]||[]).map((a,t)=>{var r,o,d,n,_,b,E,A,q;return e.jsxs("div",{className:"section-product-item",children:[e.jsxs("div",{className:"product-order",children:[e.jsx("button",{onClick:()=>z(s.id,a.id,"up"),disabled:t===0,children:e.jsx(L,{size:16})}),e.jsx("span",{children:t+1}),e.jsx("button",{onClick:()=>z(s.id,a.id,"down"),disabled:t===(p[s.id]||[]).length-1,children:e.jsx(D,{size:16})})]}),e.jsx("img",{src:Array.isArray((r=a.product)==null?void 0:r.imagens)&&((o=a.product.imagens[0])==null?void 0:o.url)||"/placeholder-product.svg",alt:(d=a.product)==null?void 0:d.nome}),e.jsxs("div",{className:"product-info",children:[e.jsx("h4",{children:(n=a.product)==null?void 0:n.nome}),e.jsx("span",{className:"sku",children:(_=a.product)==null?void 0:_.sku}),e.jsxs("span",{className:"price",children:["R$ ",((E=(b=a.product)==null?void 0:b.preco_promocional)==null?void 0:E.toFixed(2))||((q=(A=a.product)==null?void 0:A.preco)==null?void 0:q.toFixed(2))]})]}),e.jsx("button",{className:"btn-remove",onClick:()=>W(a.id),children:e.jsx(F,{size:18})})]},a.id)})})]},s.id))})]})]}),H&&i&&e.jsx("div",{className:"modal-overlay",onClick:()=>v(!1),children:e.jsxs("div",{className:"modal",onClick:s=>s.stopPropagation(),children:[e.jsx("h2",{children:i.id?"Editar Banner":"Novo Banner"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tag (ex: LANÇAMENTO, PROMOÇÃO)"}),e.jsx("input",{type:"text",value:i.tag||"",onChange:s=>m({...i,tag:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Título *"}),e.jsx("input",{type:"text",value:i.title||"",onChange:s=>m({...i,title:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descrição"}),e.jsx("textarea",{value:i.description||"",onChange:s=>m({...i,description:s.target.value}),rows:3})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"URL da Imagem *"}),e.jsx("input",{type:"text",value:i.image_url||"",onChange:s=>m({...i,image_url:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Link do Botão"}),e.jsx("input",{type:"text",value:i.link_url,onChange:s=>m({...i,link_url:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Texto do Botão"}),e.jsx("input",{type:"text",value:i.button_text,onChange:s=>m({...i,button_text:s.target.value})})]}),e.jsx("div",{className:"form-group checkbox",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:i.is_active,onChange:s=>m({...i,is_active:s.target.checked})}),"Banner Ativo"]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>v(!1),children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>V(i),disabled:y||!i.title||!i.image_url,children:y?"Salvando...":"Salvar"})]})]})}),G&&S&&e.jsx("div",{className:"modal-overlay",onClick:()=>f(!1),children:e.jsxs("div",{className:"modal modal-large",onClick:s=>s.stopPropagation(),children:[e.jsx("h2",{children:"Adicionar Produto"}),e.jsx("div",{className:"products-selector",children:O.filter(s=>!(p[S]||[]).some(a=>a.product_id===s.id)).map(s=>{var a,t,r;return e.jsxs("div",{className:"product-selector-item",onClick:()=>{Q(S,s.id),f(!1)},children:[e.jsx("img",{src:Array.isArray(s.imagens)&&((a=s.imagens[0])==null?void 0:a.url)||"/placeholder-product.svg",alt:s.nome}),e.jsxs("div",{className:"product-selector-info",children:[e.jsx("h4",{children:s.nome}),e.jsx("span",{className:"sku",children:s.sku}),e.jsxs("span",{className:"price",children:["R$ ",((t=s.preco_promocional)==null?void 0:t.toFixed(2))||((r=s.preco)==null?void 0:r.toFixed(2))]})]})]},s.id)})}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{className:"btn btn-secondary",onClick:()=>f(!1),children:"Fechar"})})]})})]})}export{ce as default};
