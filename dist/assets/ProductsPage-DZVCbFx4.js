import{a as z,r as s,s as x,d as A,j as t,H as B,S as f}from"./index-BnOxMvvE.js";import{B as F}from"./Breadcrumb-cAlnVc71.js";import{P as T,a as U}from"./ProductCardSkeleton-DP8o6lnR.js";import"./chevron-right-BWlC3Y7n.js";const m=12;function G(){const[r,l]=z(),[p,j]=s.useState([]),[b,P]=s.useState([]),[v,g]=s.useState(!0),[n,y]=s.useState(0),o=Number(r.get("pagina")||"1"),c=r.get("busca")||"",i=r.get("categoria")||"",[S,N]=s.useState(c);s.useEffect(()=>{C()},[]),s.useEffect(()=>{k()},[o,c,i]);async function C(){const{data:e}=await x.from("categories").select("*").eq("ativo",!0).order("nome");P(e||[])}async function k(){g(!0);let e=x.from("products").select("*, categories(nome)",{count:"exact"}).eq("ativo",!0);c&&(e=e.ilike("nome",`%${c}%`)),i&&(e=e.eq("category_id",i));const a=(o-1)*m,{data:R,count:_}=await e.order("created_at",{ascending:!1}).range(a,a+m-1),q=(R||[]).map(h=>({...h,category:h.categories}));j(q),y(_||0),g(!1)}const d=Math.ceil(n/m),w=s.useCallback(A(e=>{const a=new URLSearchParams(r);e?a.set("busca",e):a.delete("busca"),a.delete("pagina"),l(a)},300),[]);function E(e){N(e),w(e)}function u(e){const a=new URLSearchParams(r);e>1?a.set("pagina",String(e)):a.delete("pagina"),l(a)}function L(e){const a=new URLSearchParams(r);e?a.set("categoria",e):a.delete("categoria"),a.delete("pagina"),l(a)}return t.jsxs(t.Fragment,{children:[t.jsxs(B,{children:[t.jsx("title",{children:"Produtos — Diamante Azul"}),t.jsx("meta",{name:"description",content:"Veja todos os nossos produtos de materiais hidráulicos."})]}),t.jsx(F,{items:[{label:"Produtos"}]}),t.jsxs("div",{className:"container",style:{padding:"32px 24px"},children:[t.jsx("h1",{className:"section-title mb-6",children:"Nossos Produtos"}),t.jsxs("div",{className:"flex gap-4 mb-6",style:{flexWrap:"wrap"},children:[t.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[t.jsx(f,{size:16,style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"var(--color-text-muted)"}}),t.jsx("input",{type:"text",placeholder:"Buscar produtos...",value:S,onChange:e=>E(e.target.value),style:{paddingLeft:36}})]}),t.jsxs("select",{value:i,onChange:e=>L(e.target.value),style:{minWidth:180},children:[t.jsx("option",{value:"",children:"Todas categorias"}),b.map(e=>t.jsx("option",{value:e.id,children:e.nome},e.id))]})]}),v?t.jsx("div",{className:"product-grid",children:Array.from({length:8}).map((e,a)=>t.jsx(T,{},a))}):p.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx(f,{size:48}),t.jsx("h3",{children:"Nenhum produto encontrado"}),t.jsx("p",{children:"Tente uma busca diferente ou remova os filtros."})]}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{style:{color:"var(--color-text-muted)",fontSize:14,marginBottom:16},children:[n," produto",n!==1?"s":""," encontrado",n!==1?"s":""]}),t.jsx("div",{className:"product-grid",children:p.map(e=>t.jsx(U,{product:e},e.id))}),d>1&&t.jsxs("div",{className:"pagination",children:[t.jsx("button",{className:"pagination-btn",disabled:o<=1,onClick:()=>u(o-1),children:"‹"}),Array.from({length:d}).map((e,a)=>t.jsx("button",{className:`pagination-btn ${o===a+1?"active":""}`,onClick:()=>u(a+1),children:a+1},a)),t.jsx("button",{className:"pagination-btn",disabled:o>=d,onClick:()=>u(o+1),children:"›"})]})]})]})]})}export{G as default};
