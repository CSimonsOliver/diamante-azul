import{r as t,s as a,j as e,n as r,L as l,h as o,C as E}from"./index-Cyx07lUy.js";import{C as D}from"./clock-CcGiz2G9.js";import{T as w}from"./triangle-alert-B5Q9ODJo.js";function O(){const[d,i]=t.useState({ordersToday:0,ordersWeek:0,ordersMonth:0,pendingOrders:0}),[n,h]=t.useState([]),[c,x]=t.useState([]),[j,m]=t.useState(!0);t.useEffect(()=>{u()},[]);async function u(){try{const s=new Date,g=new Date(s.getFullYear(),s.getMonth(),s.getDate()).toISOString(),b=new Date(s.setDate(s.getDate()-7)).toISOString(),p=new Date(s.getFullYear(),s.getMonth(),1).toISOString(),[N,v,f,y,S,k]=await Promise.all([a.from("orders").select("id",{count:"exact",head:!0}).gte("created_at",g),a.from("orders").select("id",{count:"exact",head:!0}).gte("created_at",b),a.from("orders").select("id",{count:"exact",head:!0}).gte("created_at",p),a.from("orders").select("id",{count:"exact",head:!0}).eq("status","aguardando_confirmacao"),a.from("products").select("*").lt("estoque",5).eq("ativo",!0).order("estoque",{ascending:!0}).limit(10),a.from("orders").select("*").order("created_at",{ascending:!1}).limit(5)]);i({ordersToday:N.count||0,ordersWeek:v.count||0,ordersMonth:f.count||0,pendingOrders:y.count||0}),h(S.data||[]),x(k.data||[])}catch(s){console.error("Dashboard error:",s)}finally{m(!1)}}return j?e.jsx("div",{className:"dashboard-loading",children:e.jsx("div",{className:"skeleton",style:{height:200}})}):e.jsxs("div",{className:"dashboard",children:[e.jsx("h1",{className:"admin-page-title",children:"Dashboard"}),e.jsxs("div",{className:"dashboard-stats",children:[e.jsxs("div",{className:"stat-card card",children:[e.jsx("div",{className:"stat-icon",style:{background:"#DBEAFE"},children:e.jsx(r,{size:20,color:"#2563EB"})}),e.jsxs("div",{children:[e.jsx("span",{className:"stat-value",children:d.ordersToday}),e.jsx("span",{className:"stat-label",children:"Pedidos Hoje"})]})]}),e.jsxs("div",{className:"stat-card card",children:[e.jsx("div",{className:"stat-icon",style:{background:"#D1FAE5"},children:e.jsx(r,{size:20,color:"#10B981"})}),e.jsxs("div",{children:[e.jsx("span",{className:"stat-value",children:d.ordersWeek}),e.jsx("span",{className:"stat-label",children:"Pedidos na Semana"})]})]}),e.jsxs("div",{className:"stat-card card",children:[e.jsx("div",{className:"stat-icon",style:{background:"#FEF3C7"},children:e.jsx(r,{size:20,color:"#F59E0B"})}),e.jsxs("div",{children:[e.jsx("span",{className:"stat-value",children:d.ordersMonth}),e.jsx("span",{className:"stat-label",children:"Pedidos no Mês"})]})]}),e.jsxs("div",{className:"stat-card card",children:[e.jsx("div",{className:"stat-icon",style:{background:"#FEE2E2"},children:e.jsx(D,{size:20,color:"#EF4444"})}),e.jsxs("div",{children:[e.jsx("span",{className:"stat-value",children:d.pendingOrders}),e.jsx("span",{className:"stat-label",children:"Aguardando Confirmação"})]})]})]}),e.jsxs("div",{className:"dashboard-panels",children:[e.jsxs("div",{className:"dashboard-panel card",children:[e.jsxs("div",{className:"dashboard-panel-header",children:[e.jsxs("h2",{children:[e.jsx(w,{size:18})," Estoque Baixo"]}),e.jsx(l,{to:"/admin/produtos",className:"btn btn-sm btn-outline",children:"Ver todos"})]}),n.length===0?e.jsx("p",{className:"dashboard-empty",children:"Nenhum produto com estoque baixo ✅"}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Produto"}),e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Estoque"}),e.jsx("th",{children:"Preço"})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"truncate",style:{maxWidth:200},children:s.nome}),e.jsx("td",{children:s.sku}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.estoque===0?"badge-red":"badge-yellow"}`,children:s.estoque})}),e.jsx("td",{children:o(s.preco)})]},s.id))})]})})]}),e.jsxs("div",{className:"dashboard-panel card",children:[e.jsxs("div",{className:"dashboard-panel-header",children:[e.jsxs("h2",{children:[e.jsx(E,{size:18})," Últimos Pedidos"]}),e.jsx(l,{to:"/admin/pedidos",className:"btn btn-sm btn-outline",children:"Ver todos"})]}),c.length===0?e.jsx("p",{className:"dashboard-empty",children:"Nenhum pedido ainda"}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Pedido"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:s.numero_pedido})}),e.jsx("td",{children:s.customer_name}),e.jsx("td",{children:o(s.total)}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-primary",children:s.status.replace(/_/g," ")})})]},s.id))})]})})]})]})]})}export{O as default};
