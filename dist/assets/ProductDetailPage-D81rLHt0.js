import{b as B,r,e as D,s as I,j as e,L as O,g as T,H as M,f as v,h as m,M as W,P as $,i as F,k as C,l as H,z as S,m as R}from"./index-EEQCH9Mm.js";import{B as U}from"./Breadcrumb-DCKXTxYj.js";import{C as V}from"./chevron-left-Rq-fDUFf.js";import{C as J}from"./chevron-right-DXjVagqj.js";import{T as K}from"./truck-emSx_srn.js";function ee(){var N,b;const{slug:o}=B(),[s,z]=r.useState(null),[P,n]=r.useState(!0),[i,u]=r.useState(1),[h,l]=r.useState(0),[g,k]=r.useState(""),[x,j]=r.useState([]),[f,y]=r.useState(!1),_=D(t=>t.addItem);r.useEffect(()=>{E()},[o]);async function E(){if(n(!0),!o){n(!1);return}const{data:t}=await I.from("products").select("*, categories(nome, slug)").eq("slug",o).single();if(t){const a={...t,category:t.categories};z(a)}n(!1)}function q(){!s||s.estoque<=0||(_(s,i),S.success("Produto adicionado ao carrinho!"))}async function w(){const t=C(g);if(!R(t)){S.error("CEP inválido");return}if(s){y(!0);try{const a=await fetch("undefined/functions/v1/calculate-shipping",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({cep_destino:t,produtos:[{peso:s.peso_kg,altura:s.altura_cm,largura:s.largura_cm,comprimento:s.comprimento_cm,quantidade:i}]})});if(!a.ok)throw new Error("API error");const p=await a.json();j(p)}catch{j([{id:"1",nome:"PAC",empresa:"Correios",preco:18.5,prazo_dias:7,logo:""},{id:"2",nome:"SEDEX",empresa:"Correios",preco:32.9,prazo_dias:3,logo:""}])}finally{y(!1)}}}if(P)return e.jsx("div",{className:"container p-6",children:e.jsx("div",{className:"skeleton",style:{height:400}})});if(!s)return e.jsx("div",{className:"container p-6",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"Produto não encontrado"}),e.jsx(O,{to:"/produtos",className:"btn btn-primary mt-4",children:"Ver Produtos"})]})});const L=s.preco_promocional??s.preco,d=s.preco_promocional&&s.preco_promocional<s.preco,A=d?T(s.preco,s.preco_promocional):0,c=(N=s.imagens)!=null&&N.length?s.imagens:[{url:"",ordem:0}];return e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsxs("title",{children:[s.nome," — Diamante Azul"]}),e.jsx("meta",{name:"description",content:s.descricao_curta||s.nome})]}),e.jsx(U,{items:[{label:"Produtos",href:"/produtos"},...s.category?[{label:s.category.nome,href:`/categoria/${s.category.slug||""}`}]:[],{label:s.nome}]}),e.jsxs("div",{className:"container product-detail",children:[e.jsxs("div",{className:"product-detail-gallery",children:[e.jsxs("div",{className:"product-detail-main-img",children:[e.jsx("img",{src:v((b=c[h])==null?void 0:b.url),alt:s.nome,onError:t=>{t.target.src="/placeholder-product.svg"}}),d&&e.jsxs("span",{className:"badge badge-red product-detail-discount",children:["-",A,"%"]}),c.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"gallery-nav gallery-prev",onClick:()=>l(t=>(t-1+c.length)%c.length),children:e.jsx(V,{size:20})}),e.jsx("button",{className:"gallery-nav gallery-next",onClick:()=>l(t=>(t+1)%c.length),children:e.jsx(J,{size:20})})]})]}),c.length>1&&e.jsx("div",{className:"product-detail-thumbs",children:c.map((t,a)=>e.jsx("button",{className:`product-thumb ${h===a?"active":""}`,onClick:()=>l(a),children:e.jsx("img",{src:v(t.url),alt:"",onError:p=>{p.target.src="/placeholder-product.svg"}})},a))})]}),e.jsxs("div",{className:"product-detail-info",children:[s.category&&e.jsx("span",{className:"product-detail-cat",children:s.category.nome}),e.jsx("h1",{className:"product-detail-name",children:s.nome}),s.sku&&e.jsxs("p",{className:"product-detail-sku",children:["SKU: ",s.sku]}),e.jsxs("div",{className:"product-detail-prices",children:[d&&e.jsx("span",{className:"price-old",style:{fontSize:18},children:m(s.preco)}),e.jsx("span",{className:"price",style:{fontSize:28},children:m(L)})]}),s.descricao_curta&&e.jsx("p",{className:"product-detail-desc",children:s.descricao_curta}),e.jsx("div",{className:"product-detail-stock",children:s.estoque>0?e.jsxs("span",{className:"badge badge-green",children:["Em estoque (",s.estoque," unidades)"]}):e.jsx("span",{className:"badge badge-red",children:"Esgotado"})}),s.estoque>0&&e.jsxs("div",{className:"product-detail-actions",children:[e.jsxs("div",{className:"product-detail-qty",children:[e.jsx("button",{onClick:()=>u(Math.max(1,i-1)),className:"qty-btn",children:e.jsx(W,{size:16})}),e.jsx("span",{children:i}),e.jsx("button",{onClick:()=>u(Math.min(s.estoque,i+1)),className:"qty-btn",disabled:i>=s.estoque,children:e.jsx($,{size:16})})]}),e.jsxs("button",{onClick:q,className:"btn btn-primary btn-lg",style:{flex:1},children:[e.jsx(F,{size:18})," Adicionar ao Carrinho"]})]}),e.jsxs("div",{className:"product-detail-shipping card p-4 mt-4",children:[e.jsxs("h3",{className:"flex items-center gap-2",style:{fontSize:14,fontWeight:600,marginBottom:12},children:[e.jsx(K,{size:18})," Calcular Frete"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"00000-000",value:H(g),onChange:t=>k(C(t.target.value)),maxLength:9,style:{flex:1}}),e.jsx("button",{onClick:w,className:"btn btn-outline",disabled:f,children:f?"Calculando...":"Calcular"})]}),x.length>0&&e.jsx("div",{className:"shipping-results mt-3",children:x.map(t=>e.jsxs("div",{className:"shipping-option",children:[e.jsxs("div",{children:[e.jsx("strong",{children:t.nome}),e.jsxs("span",{className:"shipping-prazo",children:[t.prazo_dias," dias úteis"]})]}),e.jsx("strong",{style:{color:"var(--color-primary)"},children:m(t.preco)})]},t.id))})]}),Object.keys(s.especificacoes||{}).length>0&&e.jsxs("div",{className:"product-detail-specs mt-6",children:[e.jsx("h3",{style:{fontSize:16,fontWeight:600,marginBottom:12},children:"Especificações Técnicas"}),e.jsx("div",{className:"table-container",children:e.jsx("table",{children:e.jsx("tbody",{children:Object.entries(s.especificacoes).map(([t,a])=>e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:500,width:"40%"},children:t}),e.jsx("td",{children:a})]},t))})})})]}),s.descricao_completa&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{style:{fontSize:16,fontWeight:600,marginBottom:12},children:"Descrição"}),e.jsx("div",{style:{fontSize:14,color:"var(--color-text-muted)",lineHeight:1.7,whiteSpace:"pre-wrap"},children:s.descricao_completa})]})]})]})]})}export{ee as default};
